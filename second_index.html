<!DOCTYPE html>
<html>
	<head>
		<title>Prase Palindrome</title>
	</head>
	<body>
		<table>
			<tr>
				<td>Phrase: </td>
				<td><input id="phrase_input" type="text"></td>
			</tr>
			<tr>
				<td>Palindroms Number:</td>
				<td><input id="anagrams_num"></td>
			</tr>
			<tr>
				<td><button id="result">Show Result</button></td>
			</tr>
		</table>
		<div id="output_phrase"></div>
		<script type="text/javascript" src="english_words.js"></script>
		<script type="text/javascript">
			//var words_list --> english_words.js
			var button = document.getElementById("result");
			var output_phrases = document.getElementById("output_phrase");
			
			var anagram_phrases_array = [];
			var words_match_array = [];
			var potential_anagram = [];

			var anagrams_num;
			var input_string;
			var input_string_array;

			var word_index = 0;


			function shuffle(array) {
				let currentIndex = array.length,  randomIndex;

				// While there remain elements to shuffle...
				while (currentIndex != 0) {

					// Pick a remaining element...
					randomIndex = Math.floor(Math.random() * currentIndex);
					currentIndex--;

					// And swap it with the current element.
					[array[currentIndex], array[randomIndex]] = [
					  array[randomIndex], array[currentIndex]];
				}

				return array;
			}

			shuffle(words_list);

			button.addEventListener("click", function() {

				anagrams_num = document.getElementById("anagrams_num").value;
				input_string = document.getElementById("phrase_input").value.replace(/\s/g, '');
				input_string_array = input_string.split("");

				findPotentionalWordsForAnagram();				
				createAnagramPhrases();
			});

			function findPotentionalWordsForAnagram() {

				words_list.forEach(function(tmp_word) {

					var tmp_word_array = tmp_word.split("");

					input_string.split("").forEach(function(character) {
						if(tmp_word_array.includes(character)) {
							tmp_word_array.splice(tmp_word_array.indexOf(character), 1);
						}
					});

					if(tmp_word_array.length == 0) {
						words_match_array.push(tmp_word);
					}
				});
			}



			function checkWordInRemainingString(index) {

				let tmp_word_array    = words_match_array[index].split("");
				let orig_string_array = [...input_string_array];

				for(let i = 0; i < tmp_word_array.length; i++) {

					if(orig_string_array.includes(tmp_word_array[i])) {
						orig_string_array.splice(orig_string_array.indexOf(tmp_word_array[i]), 1);
					}
					else {
						return false;
					}
				}

				input_string_array = [...orig_string_array];
				return true;
			}


			function createAnagramPhrases() {

				for(let i = word_index; i < words_match_array.length; i++) {

					if(checkWordInRemainingString(i)) {
						
						potential_anagram.push({word: words_match_array[i], index: i});
					}
				}


				let potential_anagram_str = "";
				for(let i = 0; i < potential_anagram.length; i++) {
					potential_anagram_str += potential_anagram[i].word;
				}		



				let last_word;

				function removeLastWordFromPotentialAnagram() {
					last_word = potential_anagram.pop();
					input_string_array = [...input_string_array, ...last_word.word.split("")];
					word_index = last_word.index + 1;
				}


				if(potential_anagram_str.length != input_string.length) {
						
					removeLastWordFromPotentialAnagram();
					
					if(last_word.index + 1 == words_match_array.length) {
						removeLastWordFromPotentialAnagram();
					}
					
					setTimeout(function() {
						createAnagramPhrases();
					});
				}
				else {

					let anagram_phrase_found_once = false;

					for(let i = 0; i < anagram_phrases_array.length; i++) {
						if(compareTwoArrayIfAreEqual(anagram_phrases_array[i], potentialAnagramMappedArray(potential_anagram))) {
							anagram_phrase_found_once = true;
							removeLastWordFromPotentialAnagram();
							setTimeout(function() {
								createAnagramPhrases();
							});
						}
					}
					
					if(!anagram_phrase_found_once) {
						let anagram_phrase = potentialAnagramMappedArray(potential_anagram);
						output_phrases.innerHTML += anagram_phrase.join(" ") + "<br>";

						anagram_phrases_array.push(anagram_phrase);
						potential_anagram  = [];
						input_string_array = input_string.split("");
						word_index = 0;
						setTimeout(function() {
							createAnagramPhrases();	
						});
					}
				}
			}


			function compareTwoArrayIfAreEqual(arr1, arr2) {
				for(let i = 0; i < arr1.length; i++) {
					if(arr1[i] != arr2[i])
						return false;
				}
				return true;
			}

			function potentialAnagramMappedArray(potential_anagram) {
				return potential_anagram.map(function(elem) {
					return elem.word;
				});
			}


			
		</script>
	</body>
</html>
